@model IEnumerable<ELDNET.Models.GatePass>

@{
    ViewData["Title"] = "Gate Pass List";
    var userRole = Context.Session.GetString("UserRole");
}

<div class="gatepass-list-page mt-4">
    <div class="row align-items-center mb-4">
        <div class="col-md-6">
            <h2 class="fw-bold text-primary">
                <i class="bi bi-card-checklist me-2"></i>Gate Pass List
            </h2>
        </div>
        <div class="col-md-6 text-end">
            @if (userRole == "Student" || userRole == "Faculty")
            {
                <a asp-controller="GatePass" asp-action="Create" class="btn btn-primary rounded-pill px-4 py-2 shadow-sm">
                    <i class="bi bi-plus-circle me-2"></i> Create New Gate Pass
                </a>
            }
        </div>
    </div>

    @if (Model != null && Model.Any())
    {
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-primary text-dark">
                    <tr>
                        <th>Status</th>
                        <th>School Year</th>
                        <th>Date</th>
                        <th>Name</th>
                        <th>Department</th>
                        <th>Staff Type</th>
                        <th>Plate No.</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var obj in Model)
                    {
                        string statusColor = obj.Status switch
                        {
                            "Approved" => "bg-success",
                            "Denied" => "bg-danger",
                            "Pending" => "bg-warning text-dark",
                            _ => "bg-secondary"
                        };

                        <tr>
                            <td><span class="badge @statusColor px-3 py-2">@obj.Status</span></td>
                            <td>@obj.SchoolYear</td>
                            <td>@obj.Date.ToString("yyyy-MM-dd")</td>
                            <td>@obj.Name</td>
                            <td>@obj.Department</td>
                            <td>@obj.Role</td>
                            <td>@obj.PlateNumber</td>
                            <td class="text-center">
                                <div class="btn-group" role="group" aria-label="Action Buttons">

                                    <!-- Edit button -->
                                    <a href="@((obj.Status == "Approved") ? "javascript:void(0)" : Url.Action("Edit", new { id = obj.Id }))"
                                       class="btn btn-sm btn-warning text-white mx-1 shadow-sm edit-btn"
                                       data-status="@obj.Status">
                                        <i class="bi bi-pencil-square"></i> Edit
                                    </a>

                                    <a asp-action="Details" asp-route-id="@obj.Id" class="btn btn-sm btn-info text-white mx-1 shadow-sm">
                                        <i class="bi bi-eye-fill"></i> Details
                                    </a>

                                    <a asp-action="Delete" asp-route-id="@obj.Id" class="btn btn-sm btn-danger mx-1 shadow-sm">
                                        <i class="bi bi-trash3-fill"></i> Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="alert alert-primary text-center shadow-sm">
            <i class="bi bi-info-circle"></i> No Gate Pass Records Found.
        </div>
    }
</div>

<!-- Centered Notification -->
<div id="centerNotification" class="center-notification shadow-lg animate__animated animate__fadeIn" style="display:none;">
    <div class="notification-content text-center p-4 rounded">
        <i class="bi bi-exclamation-triangle-fill text-warning" style="font-size: 2rem;"></i>
        <h5 class="mt-2 fw-bold">Cannot Edit Gate Pass</h5>
        <p class="mb-0">This gate pass is already <span class="fw-semibold">Approved</span> and cannot be edited.</p>
        <button id="closeNotification" class="btn btn-outline-secondary mt-3 px-4">OK</button>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/gatepass.css" />
    <style>
        /* Centered notification style */
        .center-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1050;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            padding: 1rem 2rem;
            min-width: 320px;
            max-width: 500px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

            .center-notification .notification-content {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

        .edit-btn {
            cursor: pointer;
        }
    </style>
}

@section Scripts {
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const editButtons = document.querySelectorAll(".edit-btn");
            const notification = document.getElementById("centerNotification");
            const closeBtn = document.getElementById("closeNotification");

            editButtons.forEach(btn => {
                btn.addEventListener("click", function (e) {
                    const status = btn.getAttribute("data-status");
                    if (status === "Approved") {
                        e.preventDefault(); // Prevent navigation
                        notification.style.display = "block";
                    }
                });
            });

            closeBtn.addEventListener("click", function () {
                notification.style.display = "none";
            });
        });
    </script>
}
