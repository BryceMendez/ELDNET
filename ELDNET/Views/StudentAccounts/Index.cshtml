@model IEnumerable<ELDNET.Models.StudentAccount>

@{
    ViewData["Title"] = "Student Accounts";
}

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="~/css/StudentAccounts/Index.css" />

<div class="page-wrapper">
    <div class="page-header">
        <h1 class="page-title">Student <span class="text-gradient">Accounts</span></h1>
        <p class="text-muted">Directly manage student access and system registries.</p>
    </div>

    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success border-0 shadow-sm rounded-4 d-flex align-items-center mb-4" role="alert">
            <i class="bi bi-check-circle-fill me-2 fs-5"></i>
            <div>@TempData["Message"]</div>
            <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="main-card">
        <div class="card-toolbar">
            <div class="toolbar-title">
                <i class="bi bi-people-fill"></i>
                <h5>Registered Students</h5>
                <span class="toolbar-count-badge">
                    <span id="totalStudents">@Model?.Count()</span> Total
                </span>
            </div>

            <div class="search-box">
                <i class="bi bi-search"></i>
                <input type="text" id="studentNameSearch" class="search-input" placeholder="Search by name or ID..." />
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0" id="studentTable">
                <thead>
                    <tr>
                        <th width="70">#</th>
                        <th>Student ID</th>
                        <th>Full Name</th>
                        <th>Email</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Any())
                    {
                        int counter = 1;
                        foreach (var student in Model)
                        {
                            <tr data-name="@student.FullName.ToLower()" data-id="@student.StudentId.ToLower()">
                                <td class="text-muted small">@counter.ToString("D2")</td>
                                <td><span class="student-id-pill">@student.StudentId</span></td>
                                <td class="fw-bold text-dark">@student.FullName</td>
                                <td class="text-muted">@student.Email</td>
                                <td class="text-center">
                                    <div class="d-flex justify-content-center gap-2">
                                        <a asp-action="Details" asp-route-id="@student.Id" class="btn-action btn-view">
                                            <i class="bi bi-eye-fill"></i> View
                                        </a>
                                        <button type="button" class="btn-action btn-delete" data-bs-toggle="modal" data-bs-target="#deleteModal@(student.Id)">
                                            <i class="bi bi-trash3-fill"></i> Delete
                                        </button>
                                    </div>

                                    <div class="modal fade" id="deleteModal@(student.Id)" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content shadow-lg">
                                                <div class="modal-header border-0 pb-0">
                                                    <h5 class="modal-title fw-bold">Delete Account</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body text-start p-4">
                                                    <p class="text-muted mb-3">You are about to permanently delete this account. This action cannot be undone.</p>
                                                    <div class="p-3 bg-light rounded-4 mb-3 border">
                                                        <div class="fw-bold text-dark">@student.FullName</div>
                                                        <small class="text-muted">Student ID: @student.StudentId</small>
                                                    </div>
                                                    <p class="text-danger small mb-0 d-flex align-items-center gap-2">
                                                        <i class="bi bi-exclamation-triangle-fill"></i>
                                                        Warning: All associated data will be lost.
                                                    </p>
                                                </div>
                                                <div class="modal-footer border-0 pt-0">
                                                    <button type="button" class="btn-modal-cancel" data-bs-dismiss="modal">Cancel</button>
                                                    <form asp-action="Delete" asp-route-id="@student.Id" method="post">
                                                        <button type="submit" class="btn-modal-delete">Confirm Deletion</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            counter++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5" class="text-center py-5 text-muted">No students found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('#studentNameSearch').on('keyup', function () {
                const searchText = $(this).val().toLowerCase();
                let total = 0;
                $('#studentTable tbody tr').each(function () {
                    const row = $(this);
                    const name = row.data('name') || "";
                    const id = row.data('id') || "";
                    if (name.includes(searchText) || id.includes(searchText)) {
                        row.show();
                        total++;
                    } else {
                        row.hide();
                    }
                });
                $('#totalStudents').text(total);
            });
        });
    </script>
}