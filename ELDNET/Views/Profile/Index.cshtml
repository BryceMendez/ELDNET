@model ELDNET.Models.ProfileEditViewModel

@{
    ViewData["Title"] = "My Profile";
}

<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="~/css/Profile/Index.css" asp-append-version="true" />

<div class="profile-breakout-wrapper">
    <div class="profile-inner-container">
        <form asp-action="Update" enctype="multipart/form-data" method="post">
            <input type="hidden" asp-for="Id" />
            <input type="hidden" asp-for="UniqueId" />
            <input type="hidden" asp-for="Role" />
            <input type="hidden" asp-for="ProfilePictureUrl" />

            <div class="profile-grid">
                <div class="p-div1 p-card">
                    <div style="position:relative; margin-bottom:15px;">
                        <img src="@Url.Content(string.IsNullOrEmpty(Model.ProfilePictureUrl) ? "~/images/defaultprofile.jpg" : Model.ProfilePictureUrl)"
                             class="pfp-circle" id="imgPreview" />

                        <input asp-for="ProfileImage" id="pfpInput" style="display:none;" accept="image/*" onchange="previewImage(this)" />
                        <label for="pfpInput" class="camera-label">
                            <i class="fa-solid fa-camera"></i>
                        </label>
                    </div>
                    <span style="font-weight:700; opacity:0.9;">@Model.Role</span>
                    <h2 style="margin:0;">@Model.FullName</h2>
                    <span style="opacity:0.7;">#@Model.UniqueId</span>
                </div>

                <div class="p-div2 p-card">
                    <div style="font-weight:700; margin-bottom:15px;"><i class="fa-solid fa-user-pen text-primary"></i> Account Settings</div>

                    <div class="input-group">
                        <label class="input-label">Full Name</label>
                        <input asp-for="FullName" class="modern-input" placeholder="Enter full name" />
                    </div>

                    <div class="input-group">
                        <label class="input-label">Email Address</label>
                        <input asp-for="Email" type="email" class="modern-input" placeholder="email@example.com" />
                    </div>

                    <div style="display:flex; gap:12px;" class="input-group">
                        <div style="flex:1;">
                            <label class="input-label">Course</label>
                            <input asp-for="Course" class="modern-input" placeholder="e.g. BSIT" />
                        </div>
                        <div style="flex:1;">
                            <label class="input-label">Section</label>
                            <input asp-for="Section" class="modern-input" placeholder="e.g. 4A" />
                        </div>
                    </div>

                    <div style="display:flex; gap:12px;" class="input-group">
                        <div style="flex:1;">
                            <label class="input-label">Gender</label>
                            <input asp-for="Gender" class="modern-input" placeholder="Male/Female" />
                        </div>
                        <div style="flex:1;">
                            <label class="input-label">Phone Number</label>
                            <input asp-for="PhoneNumber" class="modern-input" placeholder="09XXXXXXXXX" />
                        </div>
                    </div>

                    <button type="submit" class="submit-btn">Update Profile</button>
                </div>

                <div class="p-div3 p-card">
                    <div class="p-div3-header">
                        <i class="fa-solid fa-receipt"></i> Activity History
                    </div>
                    <div class="p-div3-content">
                        @if (!Model.GatePasses.Any() && !Model.LockerRequests.Any() && !Model.ReservationRooms.Any())
                        {
                            <div style="text-align:center; padding:50px; color:var(--text-muted);">
                                <i class="fa-solid fa-inbox" style="font-size:3rem; margin-bottom:15px; opacity:0.2;"></i>
                                <p>No transactions found for this account.</p>
                            </div>
                        }
                        else
                        {
                            @if (Model.GatePasses.Any())
                            {
                                <div class="section-highlight highlight-blue">
                                    <i class="fa-solid fa-car-side"></i> Gate Pass Transactions
                                </div>
                                <table class="transaction-table">
                                    <thead>
                                        <tr>
                                            <th>Date Created</th>
                                            <th>Plate Number</th>
                                            <th>Current Status</th>
                                            <th style="width:50px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.GatePasses)
                                        {
                                            <tr>
                                                <td style="font-weight:600;">@item.Date.ToString("MMM dd, yyyy")</td>
                                                <td>@item.PlateNumber</td>
                                                <td><span class="badge-status @(item.Status == "Approved" ? "bg-approved" : (item.Status == "Denied" ? "bg-denied" : "bg-pending"))">@item.Status</span></td>
                                                <td><a asp-controller="GatePass" asp-action="Details" asp-route-id="@item.Id" class="text-primary"><i class="fa-solid fa-arrow-right-long"></i></a></td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }

                            @if (Model.ReservationRooms.Any())
                            {
                                <div class="section-highlight highlight-green">
                                    <i class="fa-solid fa-door-open"></i> Room Reservation Transactions
                                </div>
                                <table class="transaction-table">
                                    <thead>
                                        <tr>
                                            <th>Date Needed</th>
                                            <th>Room #</th>
                                            <th>Current Status</th>
                                            <th style="width:50px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.ReservationRooms)
                                        {
                                            <tr>
                                                <td style="font-weight:600;">@item.DateNeeded.ToString("MMM dd, yyyy")</td>
                                                <td>@item.RoomNumber</td>
                                                <td><span class="badge-status @(item.Status == "Approved" ? "bg-approved" : (item.Status == "Denied" ? "bg-denied" : "bg-pending"))">@item.Status</span></td>
                                                <td><a asp-controller="ReservationRoom" asp-action="Details" asp-route-id="@item.Id" class="text-primary"><i class="fa-solid fa-arrow-right-long"></i></a></td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }

                            @if (Model.LockerRequests.Any())
                            {
                                <div class="section-highlight highlight-yellow">
                                    <i class="fa-solid fa-lock"></i> Locker Request Transactions
                                </div>
                                <table class="transaction-table">
                                    <thead>
                                        <tr>
                                            <th>Request Date</th>
                                            <th>Locker #</th>
                                            <th>Current Status</th>
                                            <th style="width:50px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.LockerRequests)
                                        {
                                            <tr>
                                                <td style="font-weight:600;">@item.Date.ToString("MMM dd, yyyy")</td>
                                                <td>@item.LockerNumber</td>
                                                <td><span class="badge-status @(item.Status == "Approved" ? "bg-approved" : (item.Status == "Denied" ? "bg-denied" : "bg-pending"))">@item.Status</span></td>
                                                <td><a asp-controller="LockerRequest" asp-action="Details" asp-route-id="@item.Id" class="text-primary"><i class="fa-solid fa-arrow-right-long"></i></a></td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            }
                        }
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function previewImage(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById('imgPreview').src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
}