@{
    ViewData["Title"] = "Dashboard Overview";

    int carLeft = ViewBag.CarLeft ?? 0;
    int motorLeft = ViewBag.MotorLeft ?? 0;

    int totalLockers = 100;
    int availableLockers = ViewBag.AvailableCount ?? 0;
    var occupiedLockers = (List<string>)ViewBag.OccupiedLockers ?? new List<string>();

    double lockerUsagePercent = ((double)(totalLockers - availableLockers) / totalLockers) * 100;
}

@section Styles {
    <link rel="stylesheet" href="~/css/Home/Index.css" asp-append-version="true" />
}

<div class="container-fluid px-4 py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="fw-bold text-dark mb-0">University of Cebu Request Portal</h1>
            <p class="text-muted">Real-time campus facility status and quick access.</p>
        </div>
        <div class="badge bg-white text-dark border shadow-sm p-3 rounded-pill">
            <i class="bi bi-person-badge text-primary me-2"></i> Account Type: @(User.IsInRole("Faculty") ? "Faculty" : "Student")
        </div>
    </div>

    <div class="row g-3 mb-5">
        <div class="col-md-4">
            <div class="card stat-card shadow-sm h-100 border-start border-info border-5">
                <div class="card-body">
                    <h6 class="text-muted small fw-bold text-uppercase">Parking Availability</h6>
                    <div class="d-flex justify-content-around mt-3">
                        <div class="text-center">
                            <h4 class="mb-0 fw-bold @(carLeft == 0 ? "text-danger" : "")">@(carLeft == 0 ? "FULL" : carLeft.ToString())</h4>
                            <small class="text-muted small"><i class="bi bi-car-front"></i> Cars</small>
                        </div>
                        <div class="vr"></div>
                        <div class="text-center">
                            <h4 class="mb-0 fw-bold @(motorLeft == 0 ? "text-danger" : "")">@(motorLeft == 0 ? "FULL" : motorLeft.ToString())</h4>
                            <small class="text-muted small"><i class="bi bi-bicycle"></i> Motors</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card stat-card shadow-sm h-100 border-start border-success border-5">
                <div class="card-body">
                    <h6 class="text-muted small fw-bold text-uppercase">Room View List</h6>
                    <div class="d-flex align-items-center mt-2">
                        <h5 class="mb-0 fw-bold">2nd - 8th Floor (UCB College Building)</h5>
                        <button class="ms-auto btn btn-sm btn-link text-success p-0 fw-bold text-decoration-none" data-bs-toggle="modal" data-bs-target="#roomAvailabilityModal">View Lists</button>
                    </div>
                    <small class="text-muted small">University of Cebu - Banilad Rooms</small>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card stat-card shadow-sm h-100 border-start border-warning border-5">
                <div class="card-body">
                    <h6 class="text-muted small fw-bold text-uppercase">Locker Availability</h6>
                    <div class="d-flex align-items-center mt-2">
                        <h3 class="mb-0 fw-bold @(availableLockers == 0 ? "text-danger" : "")">@availableLockers</h3>
                        <span class="ms-2 text-muted small">Slots Free</span>
                        <button class="ms-auto btn btn-sm btn-link text-warning p-0 fw-bold text-decoration-none" data-bs-toggle="modal" data-bs-target="#lockerAvailabilityModal">Status Grid</button>
                    </div>
                    <div class="progress mt-2" style="height: 6px;">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: @lockerUsagePercent%;"></div>
                    </div>
                    <div class="d-flex justify-content-between mt-1">
                        <small class="text-muted" style="font-size: 10px;">@Math.Round(lockerUsagePercent)% Occupied</small>
                        <small class="text-muted" style="font-size: 10px;">Total: @totalLockers</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-md-4">
            <div class="card service-card shadow-lg">
                <div class="card-img-container">
                    <img src="~/images/reservation.png" class="card-img-top" alt="Gate Pass">
                    <div class="overlay overlay-blue">
                        <h4 class="overlay-text text-center">Gate Pass</h4>
                    </div>
                </div>
                <div class="card-body text-center p-4">
                    <p class="text-muted small">Request vehicle gate passes and manage entry permits for campus parking.</p>
                    <a asp-controller="GatePass" asp-action="Index" class="btn-gradient btn-blue mt-2">Go to Gate Pass</a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card service-card shadow-lg">
                <div class="card-img-container">
                    <img src="~/images/roomadmin.png" class="card-img-top" alt="Room Reservation">
                    <div class="overlay overlay-green">
                        <h4 class="overlay-text text-center">Room Reservation</h4>
                    </div>
                </div>
                <div class="card-body text-center p-4">
                    <p class="text-muted small">Secure campus spaces for meetings, events, or academic activities.</p>
                    <a asp-controller="ReservationRoom" asp-action="Index" class="btn-gradient btn-green mt-2">Go to Reservation</a>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card service-card shadow-lg">
                <div class="card-img-container">
                    <img src="~/images/lockeradmin.png" class="card-img-top" alt="Locker Request">
                    <div class="overlay overlay-yellow">
                        <h4 class="overlay-text text-center">Locker Request</h4>
                    </div>
                </div>
                <div class="card-body text-center p-4">
                    <p class="text-muted small">Apply for personal storage slots and track your request status.</p>
                    <a asp-controller="LockerRequest" asp-action="Index" class="btn-gradient btn-yellow mt-2">Go to Locker</a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="roomAvailabilityModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header text-white" style="background-color: #198754;">
                <h5 class="modal-title fw-bold"><i class="bi bi-building me-2"></i>Campus Room Map</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body bg-light p-4">
                @for (int floor = 2; floor <= 8; floor++)
                {
                    <h6 class="fw-bold text-success text-uppercase border-bottom pb-1 mt-3">Floor @floor</h6>
                    <div class="room-grid mb-3">
                        @for (int roomNum = 1; roomNum <= 10; roomNum++)
                        {
                            <div class="room-item shadow-sm">Room @floor@roomNum.ToString("D2")</div>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="lockerAvailabilityModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header text-dark" style="background-color: #FFF59D;">
                <h5 class="modal-title fw-bold"><i class="bi bi-grid-3x3-gap-fill me-2"></i>Locker Availability Map</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body bg-light p-4">
                <div class="d-flex justify-content-center mb-3">
                    <span class="badge bg-success me-2 px-3">Available</span>
                    <span class="badge bg-danger px-3">Occupied</span>
                </div>
                <div class="locker-grid-dash">
                    @for (int i = 0; i < 100; i++)
                    {
                        char rowLetter = (char)('A' + (i / 10));
                        int num = (i % 10) + 1;
                        string lockerName = $"{rowLetter}{num:D2}";
                        bool isOccupied = occupiedLockers.Contains(lockerName);

                        <div class="locker-item-dash @(isOccupied ? "occupied" : "available") shadow-sm">
                            @lockerName
                        </div>
                    }
                </div>
                <div class="text-center mt-3">
                    <small class="text-muted">Displaying Lockers A01 through J10</small>
                </div>
            </div>
        </div>
    </div>
</div>